# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—Ç—Ä–æ–≥–æ–≥–æ fallback –ø—Ä–æ–º–ø—Ç–∞

## –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∏–ª–∏

**–ë—ã–ª–æ:**
```
–í—Ö–æ–¥: "–∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞"

–í—ã—Ö–æ–¥: "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–∏–¥–∞–Ω–∏—è —Ñ–æ—Ä–º—ã 
–∏ —É—Ö–æ–¥–∞ –∑–∞ –Ω–æ–≥—Ç—è–º–∏. –≠—Ç–∏ –ø–∞–ª–æ—á–∫–∏ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –ª—é–±–æ–≥–æ 
–º–∞—Å—Ç–µ—Ä–∞ –º–∞–Ω–∏–∫—é—Ä–∞. –ò—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∏—Ç—å—Å—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞–Ω–∏–∫—é—Ä–∞."
```

AI –¥–æ–±–∞–≤–ª—è–ª –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ö–æ—Ç—è –≤ –ø—Ä–æ–º–ø—Ç–µ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–æ "PRESERVE ALL WORDS".

**–°—Ç–∞–ª–æ:**
```
–í—Ö–æ–¥: "–∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞"

–í—ã—Ö–æ–¥: "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞."
```

AI —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ–ª—å–∫–æ** —Å–ª–æ–≤–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –ø—Ä–æ–º–ø—Ç–µ

### –°—Ç–∞—Ä—ã–π –ø—Ä–æ–º–ø—Ç (–º—è–≥–∫–∏–π):
```
Your task: Make the transcribed text readable and well-structured.

Rules:
1. PRESERVE ALL WORDS: Keep every word from the original text
2. Split into sentences: Add line breaks between sentences
...
```

### –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (—Å—Ç—Ä–æ–≥–∏–π):
```
CRITICAL: You are a TEXT FORMATTER, not a writer. Your ONLY job is to format existing text.

STRICT RULES:
1. DO NOT ADD ANY NEW WORDS - Use ONLY the words from the original text
2. DO NOT EXPLAIN - No descriptions, no examples, no elaborations
3. DO NOT EXPAND - If the text says "orange sticks for manicure", output ONLY "orange sticks for manicure"
4. DO NOT COMPLETE - If a sentence is incomplete, leave it incomplete

FORBIDDEN ACTIONS:
- Adding explanations (like "They are used for...")
- Adding descriptions (like "These sticks are...")
...

Example:
Input: "orange sticks for manicure"
CORRECT: "Orange sticks for manicure."
WRONG: "Orange sticks for manicure. They are used for shaping and caring for nails."
```

## –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–Ø–≤–Ω–∞—è —Ä–æ–ª—å**: "You are a TEXT FORMATTER, not a writer"
2. **–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: "DO NOT ADD", "DO NOT EXPLAIN", "DO NOT EXPAND"
3. **–°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π**: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–æ–≥–æ, —á—Ç–æ –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å
4. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç CORRECT vs WRONG –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ
5. **–°–∏–ª—å–Ω—ã–π —è–∑—ã–∫**: "CRITICAL", "STRICT RULES", "FORBIDDEN"

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ß–µ—Ä–µ–∑ UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –û—Ç–∫—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –ù–∞–π–¥–∏ –∫–∞—Ä—Ç–æ—á–∫—É "üåê –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"
4. –ù–∞–∂–º–∏ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–æ–º–ø—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç "TEXT FORMATTER" –∏ "DO NOT ADD"

### 2. –ß–µ—Ä–µ–∑ –∫–æ–¥

```python
from services.formatting_config import FormattingConfig

config = FormattingConfig.from_env()
fallback_prompt = config.get_prompt_for_app("_fallback")

print(fallback_prompt)
# –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å "TEXT FORMATTER", "DO NOT ADD", "FORBIDDEN ACTIONS"
```

### 3. –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å AI

–ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º:

**–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã:**
- "–∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞"
- "–∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ"
- "–≤—Å—Ç—Ä–µ—á–∞ –≤ —Ç—Ä–∏ —á–∞—Å–∞"
- "–Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- AI –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å **—Ç–æ–ª—å–∫–æ** —ç—Ç–∏ —Å–ª–æ–≤–∞ —Å –±–∞–∑–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å** –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, –æ–ø–∏—Å–∞–Ω–∏–π, –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–µ—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**
- "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è..."
- "–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ. –≠—Ç–æ –≤–∞–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è..."
- "–í—Å—Ç—Ä–µ—á–∞ –≤ —Ç—Ä–∏ —á–∞—Å–∞. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è..."

## –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–ú–æ–¥–µ–ª—å —Å–ª–∏—à–∫–æ–º "—É–º–Ω–∞—è"**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –†–µ—à–µ–Ω–∏–µ: –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, llama-3.3-70b-versatile –≤–º–µ—Å—Ç–æ gpt-4)

2. **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è**: –ü—Ä–∏ temperature > 0.5 –º–æ–¥–µ–ª—å –±–æ–ª–µ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–∞
   - –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏ `FORMATTING_TEMPERATURE=0.1` –≤ `.env`

3. **–ü—Ä–æ–º–ø—Ç –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç**: –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞, –µ—ë –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–±–∏–≤–∞—Ç—å fallback
   - –†–µ—à–µ–Ω–∏–µ: –û—Ç–∫–ª—é—á–∏ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–∏ –µ—ë –ø—Ä–æ–º–ø—Ç

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:

–ï—Å–ª–∏ AI –≤—Å—ë –µ—â—ë –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç, –º–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç:

```
ABSOLUTE RULE: Output MUST contain ONLY words from input. Zero tolerance for additions.

If input has 5 words, output MUST have exactly 5 words (plus punctuation).
If input has 10 words, output MUST have exactly 10 words (plus punctuation).

VIOLATION EXAMPLES (NEVER DO THIS):
‚ùå Input: "orange sticks" ‚Üí Output: "Orange sticks for manicure"
‚ùå Input: "buy milk" ‚Üí Output: "Buy milk at the store"
‚ùå Input: "meeting" ‚Üí Output: "Meeting at 3 PM"

CORRECT EXAMPLES:
‚úì Input: "orange sticks" ‚Üí Output: "Orange sticks."
‚úì Input: "buy milk" ‚Üí Output: "Buy milk."
‚úì Input: "meeting" ‚Üí Output: "Meeting."
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
uv run pytest tests/test_fallback_formatting.py -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
uv run pytest tests/test_processing_coordinator_integration.py -v
```

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å ‚úì

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

- `services/formatting_config.py` - –Ω–æ–≤—ã–π `FALLBACK_FORMATTING_PROMPT`
- `.env` - –æ–±–Ω–æ–≤–ª—ë–Ω `_fallback` –ø—Ä–æ–º–ø—Ç –≤ JSON
- `docs/FALLBACK_FORMATTING.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `tests/test_fallback_formatting.py` - –æ–±–Ω–æ–≤–ª—ë–Ω —Ç–µ—Å—Ç

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–º—É:

1. –û—Ç–∫—Ä–æ–π `.env`
2. –ù–∞–π–¥–∏ `_fallback` –≤ `FORMATTING_APP_PROMPTS`
3. –ó–∞–º–µ–Ω–∏ –ø—Ä–æ–º–ø—Ç –Ω–∞ —Å—Ç–∞—Ä—ã–π:
```
"Your task: Make the transcribed text readable and well-structured.\n\nRules:\n1. PRESERVE ALL WORDS..."
```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
