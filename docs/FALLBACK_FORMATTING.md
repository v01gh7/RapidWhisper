# Fallback Formatting

## –û–±–∑–æ—Ä

Fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –±–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É, –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∏ –æ–¥–Ω–æ–º—É –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
2. **–ê–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ** –≤ —Å–ø–∏—Å–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

### –¢–∏–ø—ã –ø—Ä–æ–º–ø—Ç–æ–≤

–í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

1. **UNIVERSAL_DEFAULT_PROMPT** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –±–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
   - –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –°–æ–∑–¥–∞—ë—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, –∞–∫—Ü–µ–Ω—Ç—ã
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

2. **FALLBACK_FORMATTING_PROMPT** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
   - **–°—Ç—Ä–æ–≥–æ–µ** –±–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - **–ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç** –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
   - –†–∞–∑–¥–µ–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
   - –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
   - –î–æ–±–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é
   - **–ó–∞–ø—Ä–µ—â–∞–µ—Ç**: –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è, –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º—ã—Å–ª–µ–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ UI

### –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `_fallback`

–í UI —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ **"üåê –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"**, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫**: "üåê –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"
- **–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å**: –î–∞, —á–µ—Ä–µ–∑ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
- **–ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å**: –ù–µ—Ç, —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–ü—Ä–æ–º–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –ë–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

#### –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –ù–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É "üåê –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"
3. –ù–∞–∂–∞—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
4. –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ fallback –ø—Ä–æ–º–ø—Ç–∞

**–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–æ–≥–∏–π –ø—Ä–æ–º–ø—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**

```
CRITICAL: You are a TEXT FORMATTER, not a writer. Your ONLY job is to format existing text.

STRICT RULES:
1. DO NOT ADD ANY NEW WORDS - Use ONLY the words from the original text
2. DO NOT EXPLAIN - No descriptions, no examples, no elaborations
3. DO NOT EXPAND - If the text says "orange sticks for manicure", output ONLY "orange sticks for manicure"
4. DO NOT COMPLETE - If a sentence is incomplete, leave it incomplete

ALLOWED ACTIONS:
- Add line breaks between sentences
- Group sentences into paragraphs
- Add basic punctuation if missing

FORBIDDEN ACTIONS:
- Adding explanations (like "They are used for...")
- Adding descriptions (like "These sticks are...")
- Adding context or background information
- Completing incomplete thoughts

Example:
Input: "orange sticks for manicure"
CORRECT: "Orange sticks for manicure."
WRONG: "Orange sticks for manicure. They are used for shaping and caring for nails."

Output ONLY the original words with formatting. Nothing more.
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã):**

```
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –°–¥–µ–ª–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–µ–º—ã–º.

–ü—Ä–∞–≤–∏–ª–∞:
1. –°–û–•–†–ê–ù–ò –í–°–ï –°–õ–û–í–ê: –ù–µ —É–¥–∞–ª—è–π –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–π —Å–ª–æ–≤–∞
2. –†–∞–∑–¥–µ–ª—è–π –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –î–æ–±–∞–≤–ª—è–π –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
3. –ì—Ä—É–ø–ø–∏—Ä—É–π –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã: –û–±—ä–µ–¥–∏–Ω—è–π —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
4. –û–ø—Ä–µ–¥–µ–ª—è–π –∑–∞–≥–æ–ª–æ–≤–∫–∏: –ï—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è —Ç–µ–º–∞, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫
5. –§–æ—Ä–º–∞—Ç–∏—Ä—É–π —Å–ø–∏—Å–∫–∏: –ï—Å–ª–∏ –ø–µ—Ä–µ—á–∏—Å–ª—è—é—Ç—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã, —Å–æ–∑–¥–∞–≤–∞–π —Å–ø–∏—Å–æ–∫

–¶–µ–ª—å: –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é —Ä–µ—á—å –≤ —á–∏—Å—Ç—ã–π, —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç.

–í—ã–≤–æ–¥–∏ –¢–û–õ–¨–ö–û –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ .env

```env
FORMATTING_APP_PROMPTS={"notion": {...}, "_fallback": {"enabled": true, "prompt": "..."}}
```

### –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞

```python
def get_prompt_for_app(app_name: str) -> str:
    # –î–ª—è _fallback
    if app_name == "_fallback":
        return custom_fallback_prompt or FALLBACK_FORMATTING_PROMPT
    
    # –î–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    if app_name in applications:
        return custom_prompt or UNIVERSAL_DEFAULT_PROMPT
    
    # –î–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    return custom_fallback_prompt or FALLBACK_FORMATTING_PROMPT
```

### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

–ö–æ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞:

1. –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –ø—Ä–æ–º–ø—Ç
3. Fallback –ø—Ä–æ–º–ø—Ç –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç—Å—è —Å –ø—Ä–æ–º–ø—Ç–æ–º –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–æ–¥–∏–Ω** –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ AI

–ü—Ä–∏–º–µ—Ä –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
```
[–ü—Ä–æ–º–ø—Ç –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏]

Additionally, apply the following formatting:
[Fallback –ø—Ä–æ–º–ø—Ç]
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–í—Å–µ–≥–¥–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç**: –î–∞–∂–µ –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
2. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å fallback –ø—Ä–æ–º–ø—Ç –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û–¥–∏–Ω API –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö –≤ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
4. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
- `tests/test_fallback_formatting.py` - unit —Ç–µ—Å—Ç—ã –¥–ª—è fallback —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `tests/test_processing_coordinator_integration.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `tests/test_formatting_config_properties.py` - property-based —Ç–µ—Å—Ç—ã

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
uv run pytest tests/test_fallback_formatting.py -v
```

## –°–º. —Ç–∞–∫–∂–µ

- [COMBINED_PROCESSING_MODE.md](COMBINED_PROCESSING_MODE.md) - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [FORMATTING_UI_GUIDE.md](FORMATTING_UI_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ UI —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
