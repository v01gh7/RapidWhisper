# Исправление кодов языков GB и US

## Проблема

GB (Great Britain) и US (USA) обе имели код `"en"`, поэтому:
1. При восстановлении языка всегда выбиралась первая найденная кнопка (GB)
2. Невозможно было различить, какую именно кнопку выбрал пользователь

## Решение

### 1. Уникальные коды языков

Изменены коды в `ui/settings_window.py`:
```python
languages = [
    ("GB", "English", "en-gb"),  # Было: "en"
    ("US", "English", "en-us"),  # Было: "en"
    ...
]
```

### 2. Нормализация кодов в i18n модуле

Обновлена функция `t()` в `utils/i18n.py`:
```python
# Normalize language code (en-gb, en-us -> en)
base_lang = lang.split('-')[0] if '-' in lang else lang
```

Теперь:
- `en-gb` → используется перевод `en`
- `en-us` → используется перевод `en`
- `ru` → используется перевод `ru`

### 3. Обновлена функция set_language()

```python
# Normalize language code (en-gb, en-us -> en for validation)
base_lang = lang_code.split('-')[0] if '-' in lang_code else lang_code

# Validate base language
if base_lang not in SUPPORTED_LANGUAGES:
    ...

# Update global state (keep full code like en-gb, en-us)
_current_language = lang_code
```

## Как это работает

1. **Пользователь выбирает US** → сохраняется `"en-us"`
2. **При восстановлении** → ищется кнопка с `language_code="en-us"` → находится US
3. **При переводе** → `"en-us"` нормализуется в `"en"` → используется английский перевод

## Преимущества

✅ GB и US теперь различимы  
✅ Выбранная кнопка корректно восстанавливается  
✅ Оба варианта используют одни и те же английские переводы  
✅ Можно добавить региональные различия в будущем (en-gb vs en-us)  

## Тестирование

1. Выберите US → Сохраните → US должна остаться выделенной
2. Выберите GB → Сохраните → GB должна остаться выделенной
3. Оба варианта показывают английский интерфейс
4. Перезапустите приложение → выбранная кнопка сохраняется

## Debug логирование

Добавлено логирование в `_save_settings()`:
- Старый и новый язык
- Текущий язык после `set_language()`
- Тестовый перевод
- Заголовок и текст сообщения

Проверьте файл `rapidwhisper.log` для отладки проблем с переводом.
